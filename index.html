<!doctype html>
<!-- template taken from https://www.sitepoint.com/a-basic-html5-template/ -->
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HTTP client snippets</title>
    <meta name="description" content="HTTP client code snippets, multiple languages">
    <meta name="author" content="Francesco Zanoni">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">
    <link rel="stylesheet" href="style.css">
    <!-- https://stackoverflow.com/questions/1321878/how-to-prevent-favicon-ico-requests -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body>

<h1>
    HTTP client snippets
    (<a href="https://github.com/francescozanoni/http-client-snippets" target="_blank">repository</a>)
</h1>

<div id="languages"><strong>Languages: </strong></div>
<div id="tags"><strong>Tags: </strong></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

<script>
    window.onerror = function (errorMessage, url, lineNumber) {
        alert("ERROR: " + errorMessage + "\n" + "URL: " + url + ":" + lineNumber);
        return true;
    };

    // https://stackoverflow.com/questions/1960473/get-all-unique-values-in-a-javascript-array-remove-duplicates
    function onlyUnique(value, index, self) {
        return self.indexOf(value) === index;
    }

    function formatLanguageName(language) {

        var output = "";

        switch (language) {
            case "bash":
                output = "Bash";
                break;
            case "javascript":
                output = "JavaScript";
                break;
            default:
                output = language.toUpperCase();
        }

        return output;
    }

    var BoxBuilder = {
        "template": '<div class="box">' +
            '<div class="header"></div>' +
            '<pre></pre>' +
            '<div class="sources"></div>' +
            '</div>',
        "build": function (metadata) {
            var box = $(this.template);
            box.data("language", metadata.language);
            box.data("tags", metadata.tags.join(","));
            box.find(".header").text(formatLanguageName(metadata.language) + ': ' + metadata.title);
            box.find("pre").attr("class", metadata.language);
            if (metadata.sources) {
                box.find(".sources").text("Sources:");
                for (var i = 0; i < metadata.sources.length; i++) {
                    var sourceLink = ' <a href="' + metadata.sources[i] + '" target="_blank">[' + (i + 1) + ']</a>';
                    box.find(".sources").append(sourceLink);
                }
            }
            return box;
        },
        "loadSnippet": function (box, metadata, callback) {
            box.find("pre").load(metadata.file_path, callback);
        }
    };

    $(document).ready(function () {
        $.getJSON("snippets/metadata.json", function (metadata) {

            var tags = [];
            var languages = [];

            for (var i = 0; i < metadata.length; i++) {
                var box = BoxBuilder.build(metadata[i]);
                BoxBuilder.loadSnippet(box, metadata[i], function () {
                    hljs.highlightBlock(this);
                });
                $("body").append(box);
                tags = tags.concat(metadata[i].tags).filter(onlyUnique);
                languages = languages.concat([metadata[i].language]).filter(onlyUnique);
            }

            $("#languages").append('<a href="#">' + languages.join('</a>, <a href="#">') + '</a>');
            $("#tags").append('<a href="#">' + tags.join('</a>, <a href="#">') + '</a>');

            // https://stackoverflow.com/questions/4871389/how-to-get-the-text-value-of-a-clicked-link
            $("#languages a").click(function (e) {
                $("#languages a, #tags a").css("font-weight", "normal");
                $(e.target).css("font-weight", "bold");
                var language = $(e.target).text();
                $(".box").hide();
                $(".box").each(function () {
                    if ($(this).data("language") === language) {
                        $(this).show();
                    }
                });
            });
            $("#tags a").click(function (e) {
                $("#languages a, #tags a").css("font-weight", "normal");
                $(e.target).css("font-weight", "bold");
                var tag = $(e.target).text();
                $(".box").hide();
                $(".box").each(function () {
                    if ($(this).data("tags").indexOf(tag) !== -1) {
                        $(this).show();
                    }
                });
            });

        });
    });
</script>

</body>
</html>
