<!doctype html>
<!-- template taken from https://www.sitepoint.com/a-basic-html5-template/ -->
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HTTP client snippets</title>
    <meta name="description" content="HTTP client code snippets, multiple languages">
    <meta name="author" content="Francesco Zanoni">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">
    <link rel="stylesheet" href="assets/style.css">
    <!-- https://stackoverflow.com/questions/1321878/how-to-prevent-favicon-ico-requests -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body>

<h1>
    HTTP client snippets
    (<a href="https://github.com/francescozanoni/http-client-snippets" target="_blank">repository</a>)
</h1>

<div id="languages"><strong>Languages: </strong></div>
<div id="tags"><strong>Tags: </strong></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

<script src="assets/functions.js"></script>

<script>
    window.onerror = errorHandler;

    var BoxBuilder = {
        "template": '<div class="box">' +
            '<div class="header"></div>' +
            '<pre class="snippet"></pre>' +
            '<div class="tags"></div>' +
            '<div class="sources"></div>' +
            '</div>',
        "build": function (metadata) {
            var box = $(this.template);
            box.data("language", metadata.language);
            box.data("tags", metadata.tags.join(","));
            box.find(".header").text(formatLanguageName(metadata.language) + ': ' + metadata.title);
            box.find(".snippet").attr("class", box.find(".snippet").attr("class") + " " + metadata.language);
            if (metadata.tags) {
                box.find(".tags").text("Tags: ");
                box.find(".tags").append(metadata.tags.join(", "));
            }
            if (metadata.sources) {
                box.find(".sources").text("Sources:");
                $.each(metadata.sources, function (index, source) {
                    box.find(".sources").append(' <a href="' + source + '" target="_blank">[' + (index + 1) + ']</a>');
                });
            }
            return box;
        },
        "loadSnippet": function (box, metadata, callback) {
            box.find(".snippet").load(metadata.file_path, callback);
        }
    };

    $(document).ready(function () {
        $.getJSON("snippets/metadata.json", function (metadata) {

            var tags = [];
            var languages = [];

            for (var i = 0; i < metadata.length; i++) {
                var box = BoxBuilder.build(metadata[i]);
                BoxBuilder.loadSnippet(box, metadata[i], function () {
                    hljs.highlightBlock(this);
                });
                $("body").append(box);
                languages = languages.concat([metadata[i].language]).filter(onlyUnique).sort();
                tags = tags.concat(metadata[i].tags).filter(onlyUnique).sort();
            }

            $.each(languages, function (index, language) {
                $("#languages").append('<input type="radio" name="language" value="' + language + '"/>');
                $("#languages").append(formatLanguageName(language) + ' ');
            });
            $.each(tags, function (index, tag) {
                $("#tags").append('<input type="checkbox" name="tags" value="' + tag + '"/>');
                $("#tags").append(tag + ' ');
            });

            $("#tags input, #languages input").click(function (e) {
                var language = $("#languages input:checked").val();
                var tags = [];
                $("#tags input:checked").each(function () {
                    tags.push($(this).val());
                });
                $(".box").hide();
                $(".box").each(function () {
                    if (language && tags.length === 0) {
                        if ($(this).data("language") === language) {
                            $(this).show();
                        }
                    }
                    if (!language && tags.length > 0) {
                        if ($(this).data("tags").split(",").filter(function (n) {
                            return tags.indexOf(n) !== -1;
                        }).length > 0) {
                            $(this).show();
                        }
                    }
                    if (language && tags.length > 0) {
                        if ($(this).data("language") === language &&
                            $(this).data("tags").split(",").filter(function (n) {
                                return tags.indexOf(n) !== -1;
                            }).length > 0) {
                            $(this).show();
                        }
                    }
                });
            });

        });
    });
</script>

</body>
</html>
